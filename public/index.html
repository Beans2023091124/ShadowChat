<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shadow Chat</title>
    <link rel="icon" type="image/svg+xml" href="./assets/shadow-chat-logo.svg" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap"
    />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div class="app-shell">
      <aside id="sidebar" class="sidebar panel">
        <header class="sidebar-header">
          <h1 class="brand-title">
            <img
              src="./assets/shadow-chat-logo.svg"
              alt="Shadow Chat"
              class="brand-logo"
            />
            Shadow Chat
          </h1>
        </header>

        <form id="friendForm" class="friend-form">
          <input
            id="friendInput"
            type="text"
            maxlength="24"
            placeholder="Add friend by name"
            autocomplete="off"
            required
          />
          <button class="button-primary" type="submit">Add</button>
        </form>

        <section class="sidebar-scroll">
          <div class="section-block">
            <h2>Incoming</h2>
            <ul id="incomingRequests" class="stack-list"></ul>
          </div>

          <div class="section-block">
            <h2>Outgoing</h2>
            <ul id="outgoingRequests" class="stack-list"></ul>
          </div>

          <div class="section-block">
            <div class="section-head">
              <h2>Friends</h2>
              <span id="friendCount" class="section-meta">0</span>
            </div>
            <ul id="friendsList" class="stack-list"></ul>
          </div>

          <div class="section-block">
            <h2>Chats</h2>
            <ul id="chatList" class="stack-list"></ul>
          </div>

        </section>

        <footer class="self-strip">
          <div id="selfAvatar" class="avatar">?</div>
          <div class="self-text">
            <p id="selfName" class="self-name">Not signed in</p>
            <p class="self-status">Online</p>
          </div>
          <button id="settingsButton" class="icon-button settings-button" type="button" title="Settings">
            &#9881;
          </button>
        </footer>
      </aside>

      <main id="chatPanel" class="chat panel">
        <header class="chat-header">
          <button id="mobileSidebarButton" class="action-button mobile-only" type="button">
            Menu
          </button>

          <div class="chat-header-copy">
            <h2 id="chatTitle">Select a chat</h2>
            <p id="chatSubtitle">Tap a friend to start chatting.</p>
          </div>

          <div class="chat-tools">
            <div class="chat-actions">
              <button
                id="voiceCallButton"
                class="action-button chat-icon-button"
                type="button"
                aria-label="Voice call"
                title="Voice call"
              >
                <svg class="action-icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path
                    d="M5 4h4l2 5-2 2a14 14 0 0 0 4 4l2-2 5 2v4a2 2 0 0 1-2 2A15 15 0 0 1 3 6a2 2 0 0 1 2-2z"
                    stroke="currentColor"
                    stroke-width="1.8"
                    stroke-linejoin="round"
                  />
                </svg>
              </button>
              <button
                id="videoCallButton"
                class="action-button chat-icon-button"
                type="button"
                aria-label="Video call"
                title="Video call"
              >
                <svg class="action-icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <rect
                    x="3"
                    y="6"
                    width="13"
                    height="12"
                    rx="2"
                    stroke="currentColor"
                    stroke-width="1.8"
                  />
                  <path
                    d="M16 10l5-3v10l-5-3z"
                    stroke="currentColor"
                    stroke-width="1.8"
                    stroke-linejoin="round"
                  />
                </svg>
              </button>
              <button
                id="toggleGroupPanelButton"
                class="action-button chat-icon-button"
                type="button"
                aria-label="Create group"
                title="Create group"
              >
                <svg class="action-icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <circle cx="9" cy="9" r="3" stroke="currentColor" stroke-width="1.8" />
                  <circle cx="17" cy="10" r="2.5" stroke="currentColor" stroke-width="1.8" />
                  <path
                    d="M3 18c0-3.2 2.7-5 6-5s6 1.8 6 5"
                    stroke="currentColor"
                    stroke-width="1.8"
                    stroke-linecap="round"
                  />
                  <path
                    d="M14.5 18c.2-1.9 1.5-3.2 3.4-3.8"
                    stroke="currentColor"
                    stroke-width="1.8"
                    stroke-linecap="round"
                  />
                </svg>
              </button>
              <button id="chatPrefsButton" class="action-button" type="button" title="Chat style">
                Style
              </button>
              <button id="openTempChatButton" class="action-button" type="button">Temp</button>
              <button id="closeTempChatButton" class="action-button hidden" type="button">
                Close Temp
              </button>
            </div>
            <label class="chat-search">
              <input
                id="messageSearchInput"
                type="search"
                maxlength="80"
                placeholder="Search (from:user links media files)"
                autocomplete="off"
              />
            </label>
          </div>
        </header>

        <section id="messages" class="messages"></section>
        <button id="jumpToUnreadButton" class="jump-unread-button hidden" type="button">
          Jump to unread
        </button>
        <section id="typingIndicator" class="typing-indicator hidden"></section>

        <section id="attachmentPreview" class="attachment-preview hidden"></section>
        <section id="replyPreview" class="reply-preview hidden"></section>

        <form id="composerForm" class="composer">
          <div class="composer-attach-wrap">
            <button id="attachButton" class="action-button" type="button">Attach</button>
            <div id="attachMenu" class="attach-menu hidden">
              <button id="attachCameraButton" class="action-button attach-menu-item" type="button">
                Camera
              </button>
              <button id="attachPhotoButton" class="action-button attach-menu-item" type="button">
                Photo
              </button>
              <button id="attachUploadButton" class="action-button attach-menu-item" type="button">
                Upload
              </button>
              <button
                id="attachVoiceNoteButton"
                class="action-button attach-menu-item"
                type="button"
              >
                Voice Note
              </button>
            </div>
          </div>
          <button id="stickerButton" class="action-button" type="button" title="Emoji and GIF">
            Emoji/GIF
          </button>
          <input id="fileInput" type="file" multiple class="hidden" />
          <input id="photoInput" type="file" accept="image/*" class="hidden" />
          <input id="cameraInput" type="file" accept="image/*" capture="environment" class="hidden" />
          <textarea
            id="messageInput"
            maxlength="1200"
            placeholder="Message"
            autocomplete="off"
            rows="1"
            disabled
          ></textarea>
          <button id="sendButton" class="button-primary" type="submit" disabled>
            Send
          </button>
        </form>
        <section id="stickerMenu" class="sticker-menu hidden">
          <header class="sticker-menu-head">
            <h3>Media</h3>
            <button id="closeStickerMenuButton" class="icon-button" type="button">X</button>
          </header>
          <div class="sticker-tabs" role="tablist" aria-label="Emoji and GIF tabs">
            <button
              id="emojiTabButton"
              class="sticker-tab active"
              type="button"
              role="tab"
              aria-selected="true"
              aria-controls="emojiTabPanel"
            >
              Emoji
            </button>
            <button
              id="gifTabButton"
              class="sticker-tab"
              type="button"
              role="tab"
              aria-selected="false"
              aria-controls="gifTabPanel"
            >
              GIF
            </button>
          </div>
          <section id="emojiTabPanel" class="sticker-tab-panel">
            <label class="sticker-search-row">
              <input
                id="emojiSearchInput"
                type="search"
                maxlength="64"
                placeholder="Search emojis"
                autocomplete="off"
              />
            </label>
            <div id="stickerEmojiGrid" class="sticker-emoji-grid" role="listbox"></div>
          </section>
          <section id="gifTabPanel" class="sticker-tab-panel hidden">
            <form id="gifSearchForm" class="sticker-search-row">
              <input
                id="gifSearchInput"
                type="search"
                maxlength="120"
                placeholder="Search Tenor GIFs"
                autocomplete="off"
              />
              <button id="gifSearchButton" class="action-button" type="submit">Search</button>
            </form>
            <div id="gifResults" class="gif-results"></div>
          </section>
        </section>
      </main>

      <aside class="profile panel">
        <h2>Profile</h2>
        <div id="profileEmpty" class="profile-empty">
          Select a friend or direct chat to see their profile.
        </div>
        <div id="profileContent" class="profile-content hidden">
          <div id="profileAvatar" class="profile-avatar">?</div>
          <h3 id="profileName">Unknown</h3>
          <p id="profileState" class="profile-state">Offline</p>
          <p id="profileMeta" class="profile-meta">Friend profile</p>
        </div>
        <div id="profileGroupContent" class="profile-group-content hidden">
          <h3 id="profileGroupTitle">Group</h3>
          <p id="profileGroupMeta" class="profile-meta">0 members</p>
          <ul id="profileGroupList" class="profile-group-list"></ul>
        </div>
      </aside>
    </div>

    <div id="sidebarBackdrop" class="sidebar-backdrop hidden"></div>

    <div id="authOverlay" class="auth-overlay">
      <div class="auth-card">
        <div class="auth-brand">
          <img src="./assets/shadow-chat-logo.svg" alt="Shadow Chat" class="auth-logo" />
          <h2>Shadow Chat</h2>
        </div>
        <div class="auth-tabs">
          <button id="loginTabButton" class="auth-tab active" type="button">Login</button>
          <button id="signupTabButton" class="auth-tab" type="button">Sign Up</button>
        </div>
        <form id="authForm" class="auth-form">
          <input
            id="authUsernameInput"
            type="text"
            maxlength="24"
            placeholder="Username"
            autocomplete="off"
            required
          />
          <div class="password-input-wrap">
            <input
              id="authPasswordInput"
              type="password"
              maxlength="64"
              placeholder="Password"
              autocomplete="off"
              required
            />
            <button
              id="authPasswordToggleButton"
              class="password-toggle-button"
              type="button"
              aria-label="Show password"
              aria-pressed="false"
              title="Show password"
            >
              <svg
                class="password-toggle-icon"
                viewBox="0 0 24 24"
                fill="none"
                aria-hidden="true"
              >
                <path
                  d="M2 12s3.6-6 10-6 10 6 10 6-3.6 6-10 6-10-6-10-6Z"
                  stroke="currentColor"
                  stroke-width="1.8"
                  stroke-linejoin="round"
                />
                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="1.8" />
                <path
                  class="password-toggle-slash"
                  d="M4 20 20 4"
                  stroke="currentColor"
                  stroke-width="1.8"
                  stroke-linecap="round"
                />
              </svg>
            </button>
          </div>
          <div id="authConfirmRow" class="hidden">
            <div class="password-input-wrap">
              <input
                id="authConfirmInput"
                type="password"
                maxlength="64"
                placeholder="Confirm password"
                autocomplete="off"
              />
              <button
                id="authConfirmToggleButton"
                class="password-toggle-button"
                type="button"
                aria-label="Show password"
                aria-pressed="false"
                title="Show password"
              >
                <svg
                  class="password-toggle-icon"
                  viewBox="0 0 24 24"
                  fill="none"
                  aria-hidden="true"
                >
                  <path
                    d="M2 12s3.6-6 10-6 10 6 10 6-3.6 6-10 6-10-6-10-6Z"
                    stroke="currentColor"
                    stroke-width="1.8"
                    stroke-linejoin="round"
                  />
                  <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="1.8" />
                  <path
                    class="password-toggle-slash"
                    d="M4 20 20 4"
                    stroke="currentColor"
                    stroke-width="1.8"
                    stroke-linecap="round"
                  />
                </svg>
              </button>
            </div>
          </div>
          <button id="authSubmitButton" class="button-primary" type="submit">Login</button>
        </form>
        <p id="authSwitchText" class="auth-help">
          Need an account? Switch to Sign Up.
        </p>
      </div>
    </div>

    <div id="settingsModal" class="modal hidden">
      <div class="modal-card">
        <header class="modal-head">
          <h2>Settings</h2>
          <button id="closeSettingsButton" class="icon-button" type="button">X</button>
        </header>
        <div class="modal-body">
          <section class="settings-block">
            <h3>Profile</h3>
            <div class="settings-avatar-row">
              <div id="settingsAvatarPreview" class="avatar settings-avatar">?</div>
              <input id="settingsAvatarInput" type="file" accept="image/*" />
            </div>
            <input
              id="settingsDisplayNameInput"
              type="text"
              maxlength="24"
              placeholder="Username"
              autocomplete="off"
            />
            <button id="saveProfileButton" class="button-primary" type="button">Save Profile</button>
          </section>

          <section class="settings-block">
            <h3>Password</h3>
            <input
              id="settingsCurrentPasswordInput"
              type="password"
              maxlength="64"
              placeholder="Current password"
              autocomplete="off"
            />
            <input
              id="settingsNewPasswordInput"
              type="password"
              maxlength="64"
              placeholder="New password"
              autocomplete="off"
            />
            <button id="changePasswordButton" class="action-button" type="button">
              Change Password
            </button>
          </section>

          <section class="settings-block">
            <h3>Devices</h3>
            <p class="settings-sessions-copy">Manage where your account is signed in.</p>
            <button id="revokeOtherSessionsButton" class="action-button" type="button">
              Sign Out Other Devices
            </button>
            <ul id="settingsSessionsList" class="settings-sessions-list"></ul>
            <p id="settingsSessionsEmpty" class="settings-sessions-empty hidden">
              No active sessions found.
            </p>
          </section>

          <section class="settings-block danger">
            <h3>Account</h3>
            <input
              id="settingsDeletePasswordInput"
              type="password"
              maxlength="64"
              placeholder="Password to delete account"
              autocomplete="off"
            />
            <button id="deleteAccountButton" class="danger-button" type="button">
              Delete Account
            </button>
          </section>

          <button id="enableNotificationsButton" class="action-button" type="button">
            Desktop Notifications
          </button>
          <button id="toggleEnterToSendButton" class="action-button" type="button">
            Enter to send: On
          </button>
          <button id="logoutButton" class="action-button" type="button">Log Out</button>
        </div>
      </div>
    </div>

    <div id="inlinePromptModal" class="modal hidden">
      <div class="modal-card prompt-card">
        <header class="modal-head">
          <h2 id="inlinePromptTitle">Edit</h2>
          <button id="inlinePromptCancelButton" class="icon-button" type="button">X</button>
        </header>
        <form id="inlinePromptForm" class="modal-body prompt-body">
          <p id="inlinePromptDescription" class="prompt-description hidden"></p>
          <textarea
            id="inlinePromptInput"
            maxlength="1200"
            rows="4"
            placeholder=""
            autocomplete="off"
          ></textarea>
          <div class="prompt-actions">
            <button id="inlinePromptSubmitButton" class="button-primary" type="submit">Save</button>
          </div>
        </form>
      </div>
    </div>

    <div id="groupCreateModal" class="modal hidden">
      <div class="modal-card group-create-card">
        <header class="modal-head">
          <h2 id="groupCreateTitle">Select Friends</h2>
          <button id="closeGroupCreateModalButton" class="icon-button" type="button">X</button>
        </header>
        <div class="modal-body group-create-body">
          <p id="groupCreateHint" class="group-create-hint">You can add up to 8 more friends.</p>
          <input
            id="groupCreateSearchInput"
            type="search"
            maxlength="24"
            placeholder="Type the username of a friend"
            autocomplete="off"
          />
          <p id="groupCreateEmpty" class="group-create-empty hidden">
            No friends found that are not already in this DM.
          </p>
          <ul id="groupCreateFriendList" class="group-create-list"></ul>
        </div>
        <footer class="group-create-footer">
          <button id="createGroupFromDirectButton" class="button-primary" type="button" disabled>
            Create Group DM
          </button>
        </footer>
      </div>
    </div>

    <div id="incomingCallPrompt" class="call-prompt hidden">
      <div class="call-prompt-card">
        <p id="incomingCallText">Incoming call</p>
        <p id="incomingCallRings" class="call-rings">Ring 1 of 5</p>
        <div class="call-prompt-actions">
          <button id="acceptCallButton" class="button-primary" type="button">Accept</button>
          <button id="declineCallButton" class="action-button" type="button">Decline</button>
        </div>
      </div>
    </div>

    <div id="callOverlay" class="call-overlay hidden">
      <div class="call-card">
        <header class="call-head">
          <div class="call-head-copy">
            <h2 id="callTitle">Call</h2>
            <p id="callStatus">Connecting...</p>
            <p id="callDuration" class="call-duration hidden">Duration 00:00</p>
            <div id="remoteMediaStatus" class="remote-media-status hidden">
              <span id="remoteMicIndicator" class="remote-media-pill">Mic on</span>
              <span id="remoteCameraIndicator" class="remote-media-pill">Cam on</span>
            </div>
          </div>
          <div class="call-head-tags">
            <span id="callQualityBadge" class="call-quality-badge hidden">Quality: Checking</span>
            <span id="callModeBadge" class="call-mode-badge">Voice</span>
          </div>
        </header>
        <div id="callMain" class="call-main">
          <div id="callStage" class="call-stage">
            <div id="voiceCallPanel" class="voice-call-panel hidden">
              <div id="voiceCallUsers" class="voice-call-users">
                <div id="voiceCallRemoteUser" class="voice-call-user remote">
                  <div id="voiceCallAvatar" class="voice-call-avatar">?</div>
                  <p id="voiceCallName" class="voice-call-name">Friend</p>
                </div>
                <div id="voiceCallSelfUser" class="voice-call-user self">
                  <div id="voiceCallSelfAvatar" class="voice-call-avatar">?</div>
                  <p id="voiceCallSelfName" class="voice-call-name">You</p>
                </div>
              </div>
            </div>
            <div id="callVideos" class="call-videos">
              <video id="remoteVideo" autoplay playsinline></video>
              <video id="remoteCameraVideo" class="hidden" autoplay playsinline></video>
              <p id="remoteVideoName" class="call-video-name remote">Friend</p>
              <div id="remoteVideoPlaceholder" class="video-placeholder hidden">
                <div class="video-placeholder-icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none">
                    <path
                      d="M3 8a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1.5l4-2.5v10l-4-2.5V16a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8Z"
                      stroke="currentColor"
                      stroke-width="1.7"
                      stroke-linejoin="round"
                    />
                    <path
                      d="M4 4l16 16"
                      stroke="currentColor"
                      stroke-width="1.7"
                      stroke-linecap="round"
                    />
                  </svg>
                </div>
                <p id="remoteVideoPlaceholderText">Camera is off</p>
              </div>
              <canvas id="callAnnotationCanvas" class="call-annotation-canvas"></canvas>
              <video id="localVideo" autoplay playsinline muted></video>
              <p id="localVideoName" class="call-video-name local">You</p>
            </div>
          </div>
          <aside id="callChatPanel" class="call-chat-panel">
            <header class="call-chat-head">
              <h3>Call chat</h3>
            </header>
            <div id="callChatMessages" class="call-chat-messages"></div>
            <form id="callChatForm" class="call-chat-form">
              <input
                id="callChatInput"
                type="text"
                maxlength="500"
                placeholder="Send message in call"
                autocomplete="off"
              />
              <button id="callChatSendButton" class="button-primary" type="submit">Send</button>
            </form>
          </aside>
        </div>
        <div class="call-controls">
          <button id="toggleMicButton" class="action-button call-control" type="button">Mic On</button>
          <button id="toggleCameraButton" class="action-button call-control" type="button">Cam On</button>
          <button id="toggleScreenShareButton" class="action-button call-control" type="button">
            Share Screen
          </button>
          <button id="toggleCallChatButton" class="action-button call-control" type="button">
            Call Chat
          </button>
          <button id="endCallButton" class="danger-button call-control end-call" type="button">
            End Call
          </button>
        </div>
      </div>
    </div>

    <div id="toast" class="toast hidden"></div>

    <script src="/socket.io/socket.io.js"></script>
    <script src="/runtime-config.js"></script>
    <script type="module" src="./app.js"></script>
  </body>
</html>


