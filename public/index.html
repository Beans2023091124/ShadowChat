<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Shadow Chat</title>
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap"
    />
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div class="app-shell">
      <aside id="sidebar" class="sidebar panel">
        <header class="sidebar-header">
          <h1>Chats</h1>
        </header>

        <form id="friendForm" class="friend-form">
          <input
            id="friendInput"
            type="text"
            maxlength="24"
            placeholder="Add friend by name"
            autocomplete="off"
            required
          />
          <button class="button-primary" type="submit">Add</button>
        </form>

        <section class="sidebar-scroll">
          <div class="section-block">
            <h2>Incoming</h2>
            <ul id="incomingRequests" class="stack-list"></ul>
          </div>

          <div class="section-block">
            <h2>Outgoing</h2>
            <ul id="outgoingRequests" class="stack-list"></ul>
          </div>

          <div class="section-block">
            <div class="section-head">
              <h2>Friends</h2>
              <span id="friendCount" class="section-meta">0</span>
            </div>
            <ul id="friendsList" class="stack-list"></ul>
          </div>

          <div class="section-block">
            <h2>Chats</h2>
            <ul id="chatList" class="stack-list"></ul>
          </div>

          <div id="groupPanel" class="section-block hidden">
            <h2>Create Group</h2>
            <form id="groupForm" class="group-form">
              <input
                id="groupNameInput"
                type="text"
                maxlength="36"
                placeholder="Group name"
                autocomplete="off"
                required
              />
              <select id="groupMembersSelect" multiple size="4"></select>
              <button class="button-primary" type="submit">Create Group</button>
            </form>
          </div>
        </section>

        <footer class="self-strip">
          <div id="selfAvatar" class="avatar">?</div>
          <div class="self-text">
            <p id="selfName" class="self-name">Not signed in</p>
            <p class="self-status">Online</p>
          </div>
          <button id="settingsButton" class="icon-button settings-button" type="button" title="Settings">
            &#9881;
          </button>
        </footer>
      </aside>

      <main class="chat panel">
        <header class="chat-header">
          <button id="mobileSidebarButton" class="action-button mobile-only" type="button">
            Menu
          </button>

          <div class="chat-header-copy">
            <h2 id="chatTitle">Select a chat</h2>
            <p id="chatSubtitle">Tap a friend to start chatting.</p>
          </div>

          <div class="chat-actions">
            <button id="voiceCallButton" class="action-button" type="button">Voice</button>
            <button id="videoCallButton" class="action-button" type="button">Video</button>
            <button id="toggleGroupPanelButton" class="action-button" type="button">Group</button>
            <button id="openTempChatButton" class="action-button" type="button">Temp</button>
            <button id="closeTempChatButton" class="action-button hidden" type="button">
              Close Temp
            </button>
          </div>
        </header>

        <section id="messages" class="messages"></section>

        <section id="attachmentPreview" class="attachment-preview hidden"></section>

        <form id="composerForm" class="composer">
          <button id="attachButton" class="action-button" type="button">Attach</button>
          <input id="fileInput" type="file" multiple class="hidden" />
          <input
            id="messageInput"
            type="text"
            maxlength="1200"
            placeholder="Message"
            autocomplete="off"
            disabled
          />
          <button id="sendButton" class="button-primary" type="submit" disabled>
            Send
          </button>
        </form>
      </main>

      <aside class="profile panel">
        <h2>Profile</h2>
        <div id="profileEmpty" class="profile-empty">
          Select a friend or direct chat to see their profile.
        </div>
        <div id="profileContent" class="profile-content hidden">
          <div id="profileAvatar" class="profile-avatar">?</div>
          <h3 id="profileName">Unknown</h3>
          <p id="profileState" class="profile-state">Offline</p>
          <p id="profileMeta" class="profile-meta">Friend profile</p>
        </div>
      </aside>
    </div>

    <div id="sidebarBackdrop" class="sidebar-backdrop hidden"></div>

    <div id="authOverlay" class="auth-overlay">
      <div class="auth-card">
        <div class="auth-tabs">
          <button id="loginTabButton" class="auth-tab active" type="button">Login</button>
          <button id="signupTabButton" class="auth-tab" type="button">Sign Up</button>
        </div>
        <form id="authForm" class="auth-form">
          <input
            id="authUsernameInput"
            type="text"
            maxlength="24"
            placeholder="Username"
            autocomplete="off"
            required
          />
          <input
            id="authPasswordInput"
            type="password"
            maxlength="64"
            placeholder="Password"
            autocomplete="off"
            required
          />
          <div id="authConfirmRow" class="hidden">
            <input
              id="authConfirmInput"
              type="password"
              maxlength="64"
              placeholder="Confirm password"
              autocomplete="off"
            />
          </div>
          <button id="authSubmitButton" class="button-primary" type="submit">Login</button>
        </form>
        <p id="authSwitchText" class="auth-help">
          Need an account? Switch to Sign Up.
        </p>
      </div>
    </div>

    <div id="settingsModal" class="modal hidden">
      <div class="modal-card">
        <header class="modal-head">
          <h2>Settings</h2>
          <button id="closeSettingsButton" class="icon-button" type="button">X</button>
        </header>
        <div class="modal-body">
          <section class="settings-block">
            <h3>Profile</h3>
            <div class="settings-avatar-row">
              <div id="settingsAvatarPreview" class="avatar settings-avatar">?</div>
              <input id="settingsAvatarInput" type="file" accept="image/*" />
            </div>
            <input
              id="settingsDisplayNameInput"
              type="text"
              maxlength="24"
              placeholder="Display name"
              autocomplete="off"
            />
            <button id="saveProfileButton" class="button-primary" type="button">Save Profile</button>
          </section>

          <section class="settings-block">
            <h3>Password</h3>
            <input
              id="settingsCurrentPasswordInput"
              type="password"
              maxlength="64"
              placeholder="Current password"
              autocomplete="off"
            />
            <input
              id="settingsNewPasswordInput"
              type="password"
              maxlength="64"
              placeholder="New password"
              autocomplete="off"
            />
            <button id="changePasswordButton" class="action-button" type="button">
              Change Password
            </button>
          </section>

          <section class="settings-block danger">
            <h3>Account</h3>
            <input
              id="settingsDeletePasswordInput"
              type="password"
              maxlength="64"
              placeholder="Password to delete account"
              autocomplete="off"
            />
            <button id="deleteAccountButton" class="danger-button" type="button">
              Delete Account
            </button>
          </section>

          <button id="enableNotificationsButton" class="action-button" type="button">
            Enable Desktop Notifications
          </button>
          <button id="logoutButton" class="action-button" type="button">Log Out</button>
        </div>
      </div>
    </div>

    <div id="incomingCallPrompt" class="call-prompt hidden">
      <div class="call-prompt-card">
        <p id="incomingCallText">Incoming call</p>
        <p id="incomingCallRings" class="call-rings">Ring 1 of 5</p>
        <div class="call-prompt-actions">
          <button id="acceptCallButton" class="button-primary" type="button">Accept</button>
          <button id="declineCallButton" class="action-button" type="button">Decline</button>
        </div>
      </div>
    </div>

    <div id="callOverlay" class="call-overlay hidden">
      <div class="call-card">
        <h2 id="callTitle">Call</h2>
        <p id="callStatus">Connecting...</p>
        <div class="call-videos">
          <video id="remoteVideo" autoplay playsinline></video>
          <video id="localVideo" autoplay playsinline muted></video>
        </div>
        <div class="call-controls">
          <button id="toggleMicButton" class="action-button" type="button">Mic On</button>
          <button id="toggleCameraButton" class="action-button" type="button">Cam On</button>
          <button id="endCallButton" class="danger-button" type="button">End Call</button>
        </div>
      </div>
    </div>

    <div id="toast" class="toast hidden"></div>

    <script src="/socket.io/socket.io.js"></script>
    <script type="module" src="./app.js"></script>
  </body>
</html>

